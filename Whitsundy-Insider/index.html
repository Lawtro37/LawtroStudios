<!DOCTYPE html>
<html lang="en">
<head>
  <!--<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <link rel="stylesheet" href="style.css">
  <title>Add Business</title>
  <script src="https://www.google.com/recaptcha/enterprise.js?render=6Le7BHwmAAAAAOZrKb__LgYteXV6ovBoPySYWFE2"></script>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Add buseness Whitsunday Insider">
  <meta name="keywords" content="Whitsunday Insider, Whitsunday">
  <meta name="author" content="Lawtro">
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/devtools-detect@1.2.0/dist/devtools-detect.min.js"></script>

  <div class="header">
    <div class="header-title">Local Business App</div>
    <div>
      <!--<img src="back-icon.png" alt="Back" width="24" height="24" id="back-icon">-->
    </div>
  </div>
  <div class="container">
    <div class="title">Add your business!</div>

    <h1>business info</h1>
    <input type="text" class="input" placeholder="name" id="name-input">
    <input type="text" class="input" placeholder="image URL (400x400)" id="image-input">
    <input type="text" class="input" placeholder="brief description" id="small-description-input">
    <input type="text" class="input" placeholder="what do you do?" id="business-goal-input">
    <textarea class="discription-input" placeholder="description" id="description-input"></textarea>
    <input type="text" class="input" placeholder="location" id="location-input">

    <div class="space"></div>

    <h1>optional info</h1>
    <input type="text" class="input" placeholder="Facebook page URL" id="facebook">
    <input type="text" class="input" placeholder="Instagram page URL" id="instagram">
    <input type="text" class="input" placeholder="Tiktok page URL" id="tiktok">

    <!--<h3>recemeded info</h3>-->
    <input type="text" class="input" placeholder="business e-mail" id="email">
    <input type="text" class="input" placeholder="business phone number" id="phone number">
    <input type="text" class="input" placeholder="business website" id="website">

    <!--<div class="upload-image">
          <form action="/action_page.php">
              <label for="img" class="custom-file-upload">
                  <input type="file" id="img" name="img" accept="image/*">
                  Choose an image
              </label>
          </form>
      </div>  -->

  <p><h>Please abide by Whitsunday Insider's <a href="./terms_of_use.html">Terms of Use</a></h></p>

  <button type="button" class="button" onclick="uploadBusiness()" onmousedown="uploadBusiness()" id="submit-button">Upload Business</button>

  <div class="space"></div>
  <div class="space"></div>

  .

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <script>
    // Disable right-click
    // document.addEventListener('contextmenu', (e) => e.preventDefault());

    // function ctrlShiftKey(e, keyCode) {
    //   return e.ctrlKey && e.shiftKey && e.keyCode === keyCode.charCodeAt(0);
    // }

    // document.onkeydown = (e) => {
    //   // Disable F12, Ctrl + Shift + I, Ctrl + Shift + J, Ctrl + U
    //   if (
    //     event.keyCode === 123 ||
    //     ctrlShiftKey(e, 'I') ||
    //     ctrlShiftKey(e, 'J') ||
    //     ctrlShiftKey(e, 'C') ||
    //     (e.ctrlKey && e.keyCode === 'U'.charCodeAt(0))
    //   )
    //   return false;
    // };

    const firebaseConfig = {
      apiKey: "AIzaSyCnLQUKtxo8qrK6gmu1MoDu9er4R4SUnr4",
      authDomain: "whitsunday-insider.firebaseapp.com",
      databaseURL: "https://whitsunday-insider-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "whitsunday-insider",
      storageBucket: "whitsunday-insider.appspot.com",
      messagingSenderId: "432159444041",
      appId: "1:432159444041:web:9e0e07c30f1fb1eecf8398",
      measurementId: "G-54098J2K0G"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function uploadBusiness() {

      console.log("test")

      const name = document.getElementById("name-input").value;
      const image = document.getElementById("image-input").value;
      const description = document.getElementById("small-description-input").value;
      const breef_description = document.getElementById("description-input").value;
      const goal = document.getElementById("business-goal-input").value;
      const location = document.getElementById("location-input").value;

      const facebook = document.getElementById("facebook").value;
      const instagram = document.getElementById("instagram").value;
      const tiktok = document.getElementById("tiktok").value;
      const email = document.getElementById("email").value;
      const phone = document.getElementById("phone number").value;
      const web = document.getElementById("website").value;

      if (name.trim() === "") {
        console.log("Name is empty");
        alert("Please enter a valid name for the business.");
        return;
      }

      if(breef_description == "" || name == "" || goal == "" || image == "" || description == "" || location == ""){
        console.log("all fealds must be filled");
        alert("all fealds must be filled.");
        return;
      }

      // Check if a business with the same name already exists
      db.collection("businesses")
        .where("name", "==", name)
        .get()
        .then(function(querySnapshot) {
          if (querySnapshot.empty) {
            // No business with the same name exists, proceed with uploading
            // Set the business information in the specified document
            db.collection("businesses")
              .doc(name)
              .set({
                breef_discription: breef_description,
                business_ID: name,
                business_base_info_sentence: goal,
                business_image_URL: image,
                business_name: name,
                business_info: 
                {
                  description: description,
                  location: location,
                  reviews_enabled: true,
                  contacts:{
                    email: email,
                    phone: phone,
                    website: web
                  },
                  socals_URL: 
                  {
                    facebook: facebook,
                    instagram: instagram,
                    tiktok: tiktok
                  }
                },
                toatal_rating: 0,
                acepted: false
              })
              .then(function() {
                console.log("Business information stored in the document:", name);
                // alert("Business information stored in the document:"+name);
                // Clear input fields after successful upload
                document.getElementById("name-input").value = "";
                document.getElementById("image-input").value = "";
                document.getElementById("description-input").value = "";
                document.getElementById("location-input").value = "";
                window.location.replace("./added.html");
              })
              .catch(function(error) {
                console.error("Error storing business information:", error);
                alert("Error storing business information:", error);
              });
          } else {
            // A business with the same name already exists
            console.log("There is already a business with this name:", name);
            alert("There is already a business with this name:", name)
          }
        })
        .catch(function(error) {
          console.error("Error checking business name:", error);
          alert("Error checking business name:", error);
        });
    }

  defer
  </script>
   <script>
    // Set the SameSite attribute for the cookie
    document.cookie = "cookieName=cookieValue; SameSite=Strict; Secure";
  </script>
</body>
</html>
